#!/usr/bin/env python3

import time
from origin.neuron import Dendrite
from origin.captive_portal import CONF_PATH, GUEST_ACCESS_CONF_PATH

def conf_updated(dendrite, path, data):
    if path == 'captive-portal':
        for profile in data:
            dendrite.synapse.hset(CONF_PATH, profile['id'], profile)
    elif path == 'guest-access':
        for profile in data:
            dendrite.synapse.hset(GUEST_ACCESS_CONF_PATH, profile['id'], profile)

conf = Dendrite('captive-portal', answer_cb = conf_updated)
conf.subscribe('captive-portal')
conf.subscribe('guest-access')

count = 1
while count < 100:
    try:
        conf.run_for_ever()
    except:
        import traceback
        traceback.print_exc()
    time.sleep(30)
    count = count + 1
