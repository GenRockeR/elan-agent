#!/usr/bin/env python

import time
from origin.synapse import Synapse
from origin.captive_portal import CONF_PATH

class CaptivePortalConfiguration:
    
    def __init__(self):
        self.synapse = Synapse()
        self.synapse.subscribe('captive-portal')

    def conf_updated(self, path, conf):
        if path == 'captive-portal':
            for profile in conf:
                self.synapse.hset(CONF_PATH, profile['id'], profile)

    def run(self):
        self.synapse.run_forever(message_cb=self.conf_updated)



if __name__ == "__main__":
    conf = CaptivePortalConfiguration()
    count = 1
    while count < 100:
        conf.run()
        time.sleep(30)
        count = count + 1
